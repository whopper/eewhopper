version: 1.3.0

variables:
  global:
    COMPOSER_BIN: $SOURCE_DIR/vendor/bin
    BLT_DIR: $SOURCE_DIR/vendor/acquia/blt

cde-databases:
  - testdb1
  - testmigratedb1

events:
  build:
    steps:
      - setup-env:
          type: script
          script:
#            - composer require acquia/blt:^10.0 --no-update
#            - composer update
#            - ./vendor/bin/blt setup
            - mkdir docroot
            - pushd docroot
            - curl --retry 3 --location --fail --silent --show-error --output archive.tar.gz https://www.drupal.org/download-latest/tar.gz
            - tar --strip-components=1 -zxf archive.tar.gz
            - rm -rf archive.tar.gz
            - mkdir -p sites/default/files
            - cp ../settings.php ./sites/default
# need to run fcw to get those files in place...
# maybe the cloud task does that before any of this
  post-deploy:
    steps:
      - deploy:
          script:
            - pipelines-deploy
